<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload File</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h2>Welcome, {{ session['username'] }}</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class = "alert">{{ message }}</div>
        {% endfor %} 
      {% endif %}
    {% endwith %}

    <div class="upload-section">
      <input type="file" name="file" id="fileInput" class="file-input" form="uploadForm" required>
      <button form="uploadForm" class="btn btn-primary">Upload</button>
      <form id="uploadForm" method="POST" enctype="multipart/form-data"></form>
    </div>

    <div class="file-list-section">
      <input type="text" id="fileSearch" placeholder="🔍 Filter files" class="search-input" />
      {% if files %}
        <ul class="file-list">
          {% for file in files %}
            <li class="file-entry">
               <span class="filename">{{ file[:-4] if file.endswith('.enc') else file }}</span>
               <div class="action-buttons">
                 <a href="{{ url_for('download_file', filename=file) }}" class="btn link-btn">Download</a>
                 <form method="post" action="{{ url_for('delete_file', filename=file) }}" onsubmit="return confirm('Are you sure you want to delete this file?');">
                   <button type="submit" class="btn btn-delete">Delete</button>
                 </form>
               </div>
             </li>
           {% endfor %}
         </ul>
       {% else %}
         <p>No files uploaded yet.</p>
       {% endif %}
     </div>

     <button class="btn btn-logout" onclick="location.href='{{ url_for('logout') }}'">Logout</button>
   </div>

   <script>
    // Filter
     document.getElementById('fileSearch').addEventListener('input', function() {
       const q = this.value.toLowerCase();
       document.querySelectorAll('.filename').forEach(el => {
         el.closest('.file-entry').style.display = el.textContent.toLowerCase().includes(q) ? '' : 'none';
       });
     });
   </script>

</body>
</html>
